[gd_scene load_steps=20 format=3 uid="uid://dowrjcdnnxods"]

[ext_resource type="Texture2D" uid="uid://nkb633kis74n" path="res://art/sadman.png" id="1_el25n"]
[ext_resource type="Script" path="res://scripts/sad_man.gd" id="1_wtxo7"]
[ext_resource type="Script" path="res://scripts/state_machine/Idle.gd" id="3_kjit3"]
[ext_resource type="Script" path="res://scripts/state_machine/StateMachine.gd" id="3_q2x24"]
[ext_resource type="Texture2D" uid="uid://csxdmnbqetjio" path="res://art/laughing.png" id="3_wtfk3"]
[ext_resource type="Script" path="res://scripts/state_machine/Following.gd" id="5_o78q0"]
[ext_resource type="Script" path="res://scripts/state_machine/Laughing.gd" id="7_btwq4"]
[ext_resource type="AudioStream" uid="uid://cgnjpbcbc5w6u" path="res://audio/Objects/Laugh/A_Crowd_Laugh_01.wav" id="8_m2jpo"]
[ext_resource type="AudioStream" uid="uid://5gey3evtlaq" path="res://audio/Objects/Laugh/A_Crowd_Laugh_02.wav" id="9_v0tvv"]
[ext_resource type="AudioStream" uid="uid://ddsddbkvwe617" path="res://audio/Objects/Laugh/A_Crowd_Laugh_03.wav" id="10_5olv7"]
[ext_resource type="AudioStream" uid="uid://cxpsjw2myupk4" path="res://audio/Objects/Laugh/A_Crowd_Laugh_04.wav" id="11_q5hps"]
[ext_resource type="AudioStream" uid="uid://mgimv6hk3riw" path="res://audio/Objects/Laugh/A_Crowd_Laugh_05.wav" id="12_ne6cm"]

[sub_resource type="AtlasTexture" id="AtlasTexture_mqhde"]
atlas = ExtResource("3_wtfk3")
region = Rect2(0, 0, 100, 100)

[sub_resource type="AtlasTexture" id="AtlasTexture_dp2ub"]
atlas = ExtResource("3_wtfk3")
region = Rect2(100, 0, 100, 100)

[sub_resource type="SpriteFrames" id="SpriteFrames_wtm5c"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_el25n")
}],
"loop": true,
"name": &"default",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_mqhde")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dp2ub")
}],
"loop": true,
"name": &"laughing",
"speed": 5.0
}]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_q607b"]
radius = 13.0
height = 68.0

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_niccl"]
bg_color = Color(0.341176, 0.341176, 0.341176, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_rtoln"]
bg_color = Color(1, 1, 0, 1)

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_4pejl"]
streams_count = 5
stream_0/stream = ExtResource("8_m2jpo")
stream_0/weight = 1.0
stream_1/stream = ExtResource("9_v0tvv")
stream_1/weight = 1.0
stream_2/stream = ExtResource("10_5olv7")
stream_2/weight = 1.0
stream_3/stream = ExtResource("11_q5hps")
stream_3/weight = 1.0
stream_4/stream = ExtResource("12_ne6cm")
stream_4/weight = 1.0

[node name="Sad man" type="CharacterBody2D" groups=["Cakeables", "Sadman"]]
script = ExtResource("1_wtxo7")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(2.5, -1.5)
scale = Vector2(0.95, 0.97)
sprite_frames = SubResource("SpriteFrames_wtm5c")
animation = &"laughing"

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("starting_state")]
script = ExtResource("3_q2x24")
starting_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateMachine"]
script = ExtResource("3_kjit3")
animation_name = "default"

[node name="IdleTimer" type="Timer" parent="StateMachine/Idle"]
one_shot = true
autostart = true

[node name="Following" type="Node" parent="StateMachine"]
script = ExtResource("5_o78q0")
animation_name = "default"

[node name="Laughing" type="Node" parent="StateMachine" node_paths=PackedStringArray("next_state")]
script = ExtResource("7_btwq4")
next_state = NodePath("../Idle")
animation_name = "laughing"

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CapsuleShape2D_q607b")

[node name="HappinessBar" type="ProgressBar" parent="."]
offset_left = -28.0
offset_top = -40.0
offset_right = 27.0
offset_bottom = -36.0
theme_override_styles/background = SubResource("StyleBoxFlat_niccl")
theme_override_styles/fill = SubResource("StyleBoxFlat_rtoln")
value = 60.0
show_percentage = false

[node name="HitboxArea" type="Area2D" parent="."]

[node name="HitboxAreaCollision" type="CollisionShape2D" parent="HitboxArea"]
shape = SubResource("CapsuleShape2D_q607b")

[node name="HappyDepleteTimer" type="Timer" parent="."]
wait_time = 8.0
one_shot = true

[node name="GotCakedTimer" type="Timer" parent="."]
one_shot = true

[node name="LaughingPlayer" type="AudioStreamPlayer2D" parent="."]
stream = SubResource("AudioStreamRandomizer_4pejl")

[connection signal="timeout" from="StateMachine/Idle/IdleTimer" to="StateMachine/Idle" method="_on_idle_timer_timeout"]
[connection signal="area_entered" from="HitboxArea" to="." method="_on_hitbox_area_area_entered"]
[connection signal="area_exited" from="HitboxArea" to="." method="_on_hitbox_area_area_exited"]
[connection signal="timeout" from="HappyDepleteTimer" to="." method="_on_happy_deplete_timer_timeout"]
